<!-- Mini player bar -->
<div class="mini-player-progress-bar">
  <div
    class="mini-player-progress"
    [style.width.%]="duration ? (currentPosition / duration) * 100 : 0"
  ></div>
</div>
<div class="player-controls" (click)="openModal()">
  <ion-item lines="none" class="player-bar">
    <ion-thumbnail slot="start" *ngIf="trackImage">
      <img [src]="trackImage" [alt]="trackName" />
    </ion-thumbnail>
    <ion-label>
      <div class="track-title">{{ trackName }}</div>
      <div class="track-artist">{{ trackArtist }}</div>
    </ion-label>
    <ion-buttons slot="end" class="player-controls">
      <ion-button fill="clear" (click)="previous(); $event.stopPropagation()">
        <ion-icon name="play-skip-back"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="isPlaying ? pause() : play(); $event.stopPropagation()">
        <ion-icon [name]="isPlaying ? 'pause' : 'play'"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="next(); $event.stopPropagation()">
        <ion-icon name="play-skip-forward"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-item>
</div>

<!-- Inline ion-modal for fullscreen player -->
<ion-modal
  [isOpen]="showModal"
  (willDismiss)="onModalWillDismiss($event)"
  #playerModal
  class="fullscreen-player-modal"
>
  <ng-template>
    <ion-content class="fullscreen-player-content">
      <div class="modal-header">
        <ion-icon name="chevron-down-outline" class="close-icon" (click)="closeModal()"></ion-icon>
      </div>
      <div class="album-art-section">
        <ion-thumbnail class="large-thumbnail">
          <img [src]="trackImage" [alt]="trackName" />
        </ion-thumbnail>
      </div>
      <div class="track-info-section">
        <div class="track-title">{{ trackName }}</div>
        <div class="track-artist">{{ trackArtist }}</div>
      </div>
      <div class="player-progress">
        <span class="current-time">{{ currentPosition | date:'mm:ss' }}</span>
        <ion-range
          min="0"
          [max]="duration"
          [value]="currentPosition"
          (ionChange)="onSeek($event)"
          [disabled]="!duration"
          pin="true"
          color="primary"
        ></ion-range>
        <span class="duration">{{ duration | date:'mm:ss' }}</span>
      </div>
      <div class="player-controls-row">
        <ion-button fill="clear">
          <ion-icon name="shuffle-outline"></ion-icon>
        </ion-button>
        <ion-button fill="clear" (click)="previous()">
          <ion-icon name="play-skip-back"></ion-icon>
        </ion-button>
        <ion-button fill="clear" (click)="isPlaying ? pause() : play()" class="play-pause-btn">
          <ion-icon [name]="isPlaying ? 'pause' : 'play'"></ion-icon>
        </ion-button>
        <ion-button fill="clear" (click)="next()">
          <ion-icon name="play-skip-forward"></ion-icon>
        </ion-button>
        <ion-button fill="clear">
          <ion-icon name="repeat-outline"></ion-icon>
        </ion-button>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>